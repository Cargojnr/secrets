<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/ceb8cfc409.js" crossorigin="anonymous"></script>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="/styles/style.css">
    <link rel="stylesheet" href="/styles/media.css">
    <title>Document</title>
</head>
<body>

    <!-- <div id="brand-logo-container">
        <h1 id="brand-logo">Secrets</h1>
    </div>

    <script>
        window.addEventListener("load", function(){
        window.scrollTo({top: 0, behavior: 'smooth'});
        hideBrandLogo();
    });

    window.addEventListener("beforeunload", function(){
        showBrandLogo();
    })

    function showBrandLogo(){
        // const brandLogo = document.getElementById("brand-logo-container");
        document.getElementById("brand-logo-container").style.display = "flex";
  }


    function hideBrandLogo(){
        document.getElementById("brand-logo-container").style.display = "none";
    }
    </script> -->


<header>
    <div class="container">
        <div class="header">
            <a href="/secrets" id="logo"><i class="fas fa-key fa-2x"></i></a>
            <ul id="navbar">
                <li class="navbar">
                    <a href="/notifications">
                        <i class="fas fa-bell fa-2x"></i>
                        <span class="counter">0</span>
                    </a>
                </li>
                <li class="navbar dropdown">
                    <div class="hamburger" id="hamburger">
                        <div class="bar" id="bar1"></div>
                        <!-- <div class="bar" id="bar2"></div> -->
                        <div class="bar" id="bar3"></div>
                    </div> 
                        <div id="menu" class="menu-hidden">
                            <div class="container">
                                <div class="menu">
                                    <div class="menu-nav">
                                        <!-- <div class="menu-logo">
                                            <i class="fas fa-key fa-2x"></i>
                                            <h4>Anonym</h4>
                                        </div> -->
                                        <ul class="pages">
                                          <h4>Create a secret</h4>
                                          <li><a href="/secrets">View secrets</a></li>
                                          <li><a href="/submit">Share a secret</a></li>
                                        </ul>
                                        <ul class="account">
                                           <h4><i class="fas fa-user"></i> &nbsp;Account</h4>
                                           <li><a href="/logout" class="">Logout</a></li>
                                           <li><a href="/notifications" class="">Notifcations</a></li>
                                        </ul>
                                    </div>
                                    <div class="theme-switch">
                                        <input type="checkbox" id="themeToggle" class="theme-toggle">
                                        <label for="themeToggle" class="theme-toggle-label">
                                            <span class="sun-icon">‚òÄÔ∏è</span>
                                            <span class="moon-icon">üåô</span>
                                        </label>
                                     </div>
                                    <hr>
                                    <div class="menu-nav-alt">
                                        <ul class="info">
                                          <h4>Information</h4>
                                          <li><a href="">About</a></li>
                                          <li><a href="">Security</a></li>
                                          <li><a href="">Privacy</a></li>
                                          <li><a href="">Blog</a></li>
                                        </ul>
                                        <ul class="support">
                                           <h4>Support</h4>
                                           <li><a href="">FAQ</a></li>
                                           <li><a href="">Contact</a></li>
                                        </ul>
                                    </div>
                                    <ul class="socials">
                                        <li><a href=""><i class="fab fa-facebook fa-2x"></i></a></li>
                                        <li><a href=""><i class="fab fa-instagram fa-2x"></i></a></li>
                                        <li><a href=""><i class="fab fa-linkedin fa-2x"></i></a></li>
                                        <li><a href=""><i class="fab fa-github fa-2x"></i></a></li>
                                       </ul>
                                    <p class="menu-lang"><i class="fas fa-globe"></i> English</p>
                                    <button id="close">Close</button>
                                </div>
                            </div>
                        </div>  
                </li>

            </ul>
        </div>
    </div>
</header>

    <div class="jumbotron text-center">
        <div class="container">
            <!-- <i class="fas fa-key fa-6x"></i> -->
            <center>
            <h1 class="display-3">You've discovered a Secret!</h1>
            <p>Don't kiss and tell </p> 
            </center>
            <% if (locals.secret) { %>
                <ul id="secrets">
                    <h2>Secret</h2>
                        <li class="secret">
                            <div class="card">
                                <small>~~ @anonym<%= secret.user_id %> ~~</small>
                                <p><%= secret.secret %></p>

                                <div class="comment-section" data-secret-id="<%= secret.id %>">
                                    <button id="commentButton">Comment</button>
                                    <div  class="comment-dropdown" id="commentDropdown">
                                        <div class="comment-display" id="commentDisplay">
                                            <% if (locals.comments) { %>
                                                <ul id="comments">
                                                    <% comments.forEach((comment) => { %>
                                                        <li class="comment-item">
                                                            <div>
                                                                <small class="user"><strong>@anonym<%= comment.user_id %></strong></small>
                                                                <p class="comment"><%= comment.comment %></p> 
                                                            </div>
                                                                <a href="#" class="reply">Reply</a>
                                                        </li>
                                                    <% }) %>
                                                </ul>
                                               <% } else if(locals.noComment) {%>
                                                <p><%= noComment %></p>
                                              <% } %>
                                        </div>
                                        <form action="/comment" method="POST" id="comment-form">
                                            <input type="hidden" name="id" id="secretId" value="<%= secret.id %>">
                                            <input type="hidden" name="userId" value="<%= secret.user_id %>">
                                            <textarea id="commentInput" placeholder="Write a comment..." name="comment"></textarea>
                                            <!-- <input type="text" id="commentInput" placeholder="Write a comment" name="comment"> -->
                                            <button id="postCommentButton">Post</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </li>
                </ul>
            <% }  %>
           <hr>
           <br>
            <!-- <a href="/logout" class="btn btn-light btn-lg" role="button">Log Out</a> -->
            <a href="/submit" class="btn btn-dark secret-btn" role="button">Share a Secret</a>
        </div>
    </div>

    <% if (locals.comment) { %>
        <script>
            const commentButton = document.querySelectorAll("#commentButton");
        const commentDropdown = document.getElementById("commentDropdown");
        const postCommentButton = document.getElementById("postCommentButton");
        const commentInput = document.getElementById("commentInput");
        const commentDisplay = document.getElementById("comments");
              const commentForm = document.getElementById("comment-form");
    
    commentForm.addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent the form from submitting the traditional way
    
        const commentText = "<%= comment.comment %>".trim();
        const secretId = document.getElementById("secretId").value;
    
        console.log("Comment Text:", commentText); // Debugging line
        console.log("Secret ID:", secretId); // Debugging line
    
        if (commentText != "") {
            fetch("/comment", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ 
                    id: secretId, 
                    comment: commentText 
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Create new comment elements
                    const newCommentList = document.createElement("li");
                    newCommentList.className = "comment";
    
                    const newCommentDiv = document.createElement("div");
                    newCommentDiv.className = "comment";
    
                    const newCommentUser = document.createElement("small");
                    newCommentUser.className = "comment";
                    newCommentUser.textContent = "@anonym" + "<%= secret.user_id %>";
    
                    const newCommentP = document.createElement("p");
                    newCommentP.className = "comment";
                    newCommentP.textContent = data.comment;
    
                    newCommentDiv.appendChild(newCommentUser);
                    newCommentDiv.appendChild(newCommentP);
                    newCommentList.appendChild(newCommentDiv);
                    commentDisplay.appendChild(newCommentList);
    
                    commentInput = ""; // Clear input field
                } else {
                    alert("Failed to add comment");
                }
            })
            .catch(error => {
                console.error("Error:", error);
            });
        } else {
            alert("Comment cannot be empty!");
        }
    });
           </script>
    <% } %>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
         const commentButton = document.querySelectorAll("#commentButton");
    const commentDropdown = document.getElementById("commentDropdown");
    const postCommentButton = document.getElementById("postCommentButton");
    const commentInput = document.getElementById("commentInput");
    const commentDisplay = document.getElementById("comments");

    // Toggle comment dropdown visibility
    commentButton.forEach((button) => {
        button.addEventListener("click", () => {
        commentDropdown.classList.toggle("active");
        commentInput.focus();
      });
    });

    const header = document.querySelector('header');
const nextSection = document.querySelector('body').querySelector('section:not(.active)');
const logo = document.getElementById('logo')

window.addEventListener('scroll', function(){
    const scrolled = window.scrollY > 0;
   if(scrolled){
    let body = document.querySelector('body');
    body.style.overflowY = 'scroll';
    header.classList.add('scrolled');
   } else {
    header.classList.remove('scrolled');
  }
});

   
});
    </script>
    <script src="/js/app.js"></script>
</body>
</html>